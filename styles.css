        :root {
            /* --- Material 3 Baseline Theme (Purple) --- */
            --md-sys-color-primary: #6750A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #EADDFF;
            --md-sys-color-on-primary-container: #21005D;
            
            --md-sys-color-secondary: #625B71;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #E8DEF8;
            --md-sys-color-on-secondary-container: #1D192B;
            
            /* Tertiary (For Segment Buttons) */
            --md-sys-color-tertiary: #7D5260;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #FFD8E4;
            --md-sys-color-on-tertiary-container: #31111D;
            
            /* Surface & Background */
            --md-sys-color-surface: #FEF7FF;
            --md-sys-color-on-surface: #1D1B20;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-surface-container-high: #ECE6F0;
            --md-sys-color-surface-container: #F3EDF7;
            
            --md-sys-color-outline: #79747E;

            /* Motion */
            --motion-standard: cubic-bezier(0.2, 0.0, 0, 1.0);
            --motion-spring: cubic-bezier(0.25, 1.4, 0.4, 1.0);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --md-sys-color-primary: #D0BCFF;
                --md-sys-color-on-primary: #381E72;
                --md-sys-color-primary-container: #4F378B;
                --md-sys-color-on-primary-container: #EADDFF;

                --md-sys-color-tertiary: #EFB8C8;
                --md-sys-color-on-tertiary: #492532;
                --md-sys-color-tertiary-container: #633B48;
                --md-sys-color-on-tertiary-container: #FFD8E4;

                --md-sys-color-surface: #141218;
                --md-sys-color-on-surface: #E6E1E5;
                --md-sys-color-surface-container: #211F26;
                --md-sys-color-surface-container-high: #2B2930;
                --md-sys-color-surface-variant: #49454F;
                --md-sys-color-on-surface-variant: #CAC4D0;
                --md-sys-color-outline: #938F99;
            }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        /* fallback */
@font-face {
  font-family: 'Material Symbols Rounded';
  font-style: normal;
  font-weight: 100 700;
  src: url(./sykg-zNym6YjUruM-QrEh7-nyTnjDwKNJ_190FjzaqkNCeE.woff2) format('woff2');
}

.material-symbols-rounded {
  font-family: 'Material Symbols Rounded';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;

}



body {
    margin: 0; 
    padding: 0;
    /* 3. Apply the font */
    font-family: 'Google Sans Flex';
    font-variation-settings: 'opsz' 20, 'wght' 1000; 
            background-color: var(--md-sys-color-surface-container);
            height: 100vh; height: 100dvh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            color: var(--md-sys-color-on-surface);
            transition: background 0.3s;
        }

        .app-container {
            width: 100%; height: 100%;
            max-width: 412px;
            background-color: var(--md-sys-color-surface-container);
            display: flex; flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Icons Setup */
        .material-symbols-rounded {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            transition: font-variation-settings 0.2s ease;
        }
        .filled { font-variation-settings: 'FILL' 1; }

        /* --- Layout --- */
        .layout-column {
            flex: 1; display: flex; flex-direction: column;
            padding: 16px 24px; min-height: 0; overflow-y: auto;
        }

        /* --- Cover Art --- */
        .art-wrapper {
            flex: 1 1 auto;
            display: flex; align-items: center; justify-content: center;
            min-height: 120px; max-height: 45vh;
            margin: 24px 0; cursor: pointer;
        }
        .cover-art {
            height: 100%; width: auto; max-width: 100%; aspect-ratio: 1/1;
            background-color: var(--md-sys-color-surface-variant);
            border-radius: 28px;
            position: relative; overflow: hidden;
        }
        #cover-img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s; }
        #cover-img.loaded { opacity: 1; }
        .placeholder-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 80px; color: var(--md-sys-color-on-surface-variant); opacity: 0.2;
        }

/* --- Cover Art Fix (Hide Placeholder when Art exists) --- */
.cover-art.has-art .placeholder-icon {
    display: none; /* Completely remove placeholder so it doesn't bleed through */
}
.cover-art.has-art {
    background-color: transparent; /* Remove background if art is loaded */
}

        /* --- Meta Info --- */
        .meta-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-shrink: 0; gap: 16px; }
        .text-area { flex: 1; overflow: hidden; }
        .song-title { font-size: 24px; font-weight: 800; line-height: 1.2; margin: 0 0 4px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--md-sys-color-on-surface); }
        .artist-name { font-size: 16px; font-weight: 500; color: var(--md-sys-color-on-surface-variant); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .action-area { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
        .star-pill {
            height: 48px; padding: 0 20px;
            background-color: var(--md-sys-color-surface-container-high);
            color: var(--md-sys-color-on-surface-variant);
            border: none; border-radius: 99px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .star-pill.active { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); }
        .star-pill.active span { font-variation-settings: 'FILL' 1; }
        .time-txt { font-size: 14px; font-weight: 700; opacity: 0.7; margin-right: 12px; }

        /* --- Progress --- */
        .progress-container { position: relative; height: 44px; width: 100%; display: flex; align-items: center; margin-bottom: 24px; flex-shrink: 0; }
        .wave-mask { position: absolute; left: 0; top: 0; bottom: 0; width: 0%; overflow: hidden; z-index: 2; border-radius: 20px;}
        .wave-svg {
            position: absolute; left: 0; top: 50%; width: 800px; height: 24px; transform: translateY(-50%);
            fill: none; stroke: var(--md-sys-color-primary); stroke-width: 8px; stroke-linecap: round; stroke-linejoin: round;
            animation: waveFlow 2s linear infinite; animation-play-state: paused;
        }
        @keyframes waveFlow { from { transform: translateY(-50%) translateX(0); } to { transform: translateY(-50%) translateX(-80px); } }
        .progress-container.playing .wave-svg { animation-play-state: running; }
        .straight-line {
            position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 100%; height: 8px;
            background-color: var(--md-sys-color-surface-variant); border-radius: 99px; z-index: 1;
            clip-path: polygon(var(--thumb-pos, 0%) 0, 100% 0, 100% 100%, var(--thumb-pos, 0%) 100%);
        }
        .thumb {
            position: absolute; left: 0%; top: 50%; transform: translate(-50%, -50%); width: 8px; height: 24px;
            background-color: var(--md-sys-color-primary); border-radius: 4px; z-index: 3; pointer-events: none;
        }
        .seek-input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10; margin: 0; }

        /* --- Main Controls (Outlined, Shrink Stress) --- */
        .main-controls { display: flex; gap: 16px; height: 88px; margin-bottom: 24px; flex-shrink: 0; }
        
        .ctrl-btn {
            position: relative; border: none; border-radius: 28px; 
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden; 
            /* Smooth transition for flex grow/shrink */
            transition: flex 0.3s var(--motion-spring), background-color 0.2s;
        }
        /* Ensure Play/Pause/Next/Prev are always Outlined */
        .ctrl-btn span { font-size: 36px; font-variation-settings: 'FILL' 0; }

        .btn-side { 
            flex: 1; 
            background-color: var(--md-sys-color-surface-container-high); 
            color: var(--md-sys-color-on-surface-variant); 
        }
        .btn-play { 
            flex: 1.6; 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
            border-radius: 32px; 
        }
        .btn-play span { font-size: 48px; }
        
        /* -- Stretch/Stress Animation Logic -- */
        /* 1. Play Button Clicked: Play grows, sides shrink */
        .btn-play:active { flex: 3.5; }
        .main-controls:has(.btn-play:active) .btn-side { flex: 0.6; }
        
        /* 2. Side Button Clicked: Side grows, others shrink */
        .btn-side:active { 
            flex: 2.5; 
            background-color: var(--md-sys-color-primary); 
            color: var(--md-sys-color-on-primary); 
        }
        .main-controls:has(.btn-side:active) .btn-play { flex: 0.8; }
        .main-controls:has(.btn-side:active) .btn-side:not(:active) { flex: 0.6; }


        /* --- Segmented Buttons (Tertiary Colors, Filled Active) --- */
        .seg-row { 
            display: flex; height: 60px; gap: 8px; flex-shrink: 0; padding: 8px; margin-left: 28px; margin-right: 28px; border-radius: 28px;
            background-color: var(--md-sys-color-tertiary-container); /* Tertiary Container Background */
        }
        .seg-btn {
            flex: 1; border: none; 
            background-color: rgba(255,255,255,0.1); 
            color: var(--md-sys-color-on-tertiary-container);
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: background 0.2s, color 0.2s;
        }
        .seg-btn span { font-size: 26px; font-variation-settings: 'FILL' 0; }
        
        .seg-btn:first-child { border-radius: 24px 8px 8px 24px; }
        .seg-btn:nth-child(2) { border-radius: 8px; }
        .seg-btn:last-child { border-radius: 8px 24px 24px 8px; }
        
        /* Active Segment: Filled Icon + Strong Tertiary Color */
        .seg-btn.active { 
            background-color: var(--md-sys-color-on-tertiary-container); 
            color: var(--md-sys-color-tertiary-container); 
        }
        .seg-btn.active span { font-variation-settings: 'FILL' 1; } /* Filled when active */

        /* --- Bottom Sheet --- */
        .sheet-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 50; }
        .sheet-backdrop.show { opacity: 1; pointer-events: auto; }
        
        .bottom-sheet {
            position: absolute; bottom: 0; left: 0; right: 0;
            background-color: var(--md-sys-color-surface); 
            border-radius: 32px 32px 0 0;
            padding: 20px 24px 0 24px; z-index: 100; 
            transform: translateY(100%); 
            transition: transform 0.35s var(--motion-standard);
            display: flex; flex-direction: column; 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
            touch-action: none; 
        }
        .bottom-sheet.show { transform: translateY(0); }
        .sheet-handle-area { width: 100%; padding: 10px 0 20px; display: flex; justify-content: center; cursor: grab; flex-shrink: 0; }
        .sheet-handle { width: 32px; height: 4px; background: var(--md-sys-color-outline); opacity: 0.4; border-radius: 2px; }

        #playlist-sheet { height: 75%; }
        #lyrics-sheet { height: 85%; }

        .sheet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; }
        
        .profile-btn {
            height: 44px; padding: 0 24px;
            background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary);
            border: none; border-radius: 28px;
            display: flex; gap: 8px; align-items: center; justify-content: center;
            cursor: pointer; font-weight: 700;
        }
        .profile-btn span { font-size: 24px; font-variation-settings: 'FILL' 1; }

        .fav-filter {
            display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 100px;
            border: 1px solid var(--md-sys-color-outline); background: transparent; color: var(--md-sys-color-on-surface);
            font-weight: 700; cursor: pointer;
        }
        .fav-filter.active { background: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); border-color: transparent; }
        .fav-filter.active span { font-variation-settings: 'FILL' 1; }
        
        .playlist-list { flex: 1; overflow-y: auto; padding-bottom: 32px; }
        .list-item { 
            display: flex; align-items: center; gap: 12px; padding: 12px; margin-bottom: 2px; 
            background-color: var(--md-sys-color-surface-container); cursor: pointer;
                transition: transform 0.25s cubic-bezier(0.2, 0, 0, 1), background-color 0.2s;
    /* Fix: Ensure z-index is handled during drag */
    z-index: 1;
        }
        /* ADDED: Style for the item currently being dragged */
.list-item.dragging {
    opacity: 0.5; /* Fade out the original element slightly */
    z-index: 100;
}
        .list-item:first-child { border-radius: 28px 28px 4px 4px; }
        .list-item:last-child { border-radius: 4px 4px 28px 28px; }
        .list-item.playing { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); }
        
        .list-drag-handle { color: var(--md-sys-color-outline); padding: 4px; cursor: move; }
        /* --- CSS Update for List Thumbnails --- */
.list-thumb { 
    width: 52px; height: 52px; 
    border-radius: 12px; 
    background-color: var(--md-sys-color-surface-variant); 
    flex-shrink: 0; 
    overflow: hidden; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    position: relative;
}

/* The Album Placeholder Icon */
.list-thumb .material-symbols-rounded {
    font-size: 24px;
    opacity: 0.4;
    color: var(--md-sys-color-on-surface-variant);
}

/* The actual image (hidden by default until loaded) */
.list-thumb img {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%; 
    object-fit: cover; 
    display: none; /* Hidden until JS says it's ready */
    z-index: 2;
}
.list-thumb img.show { display: block; }


        .list-info { flex: 1; overflow: hidden; }
        .list-name { font-weight: 700; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .list-artist { font-weight: 500; font-size: 14px; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
      
.list-item { 
    display: flex; align-items: center; gap: 12px; padding: 12px; margin-bottom: 2px; 
    background-color: var(--md-sys-color-surface-container); 
    cursor: pointer; position: relative;
    transition: transform 0.2s ease, background-color 0.2s; /* Smooth movement */
}
/* Hide drag handle in Favorites view */
/*.list-item.no-drag .list-drag-handle {
    display: none;
}*/
.list-item.dragging {
    opacity: 0.5;
    background-color: var(--md-sys-color-surface-variant);
    transform: scale(0.98);}
        

        /* Lyrics */
        .lyrics-content {
            flex: 1; overflow-y: auto; text-align: center; padding: 20px;
            font-size: 20px; line-height: 1.6; color: var(--md-sys-color-on-surface-variant);
            font-weight: 500; white-space: pre-wrap;
        }
        .lyrics-placeholder { opacity: 0.5; margin-top: 50px; }

        /* Toast */
        .toast {
            position: absolute; top: 24px; left: 24px; right: 24px;
            background: var(--md-sys-color-on-surface); color: var(--md-sys-color-surface);
            padding: 16px; border-radius: 16px; z-index: 200;
            display: flex; justify-content: space-between; align-items: center;
            transform: translateY(-200%); transition: transform 0.4s var(--motion-standard);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        .toast.show { transform: translateY(0); }
        .toast-btn { background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border: none; padding: 8px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; }

        #legacy-input { display: none; }